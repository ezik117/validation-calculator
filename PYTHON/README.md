# Описание базовых классов и модулей калькулятора
Описываются базовые классы калькулятора, составляющие его ядро, вспомогательные классы и модули.
____
## <a id="contents"></a> Оглавление
1. [Запуск калькулятора, модуль _testing_](#launch)
2. [Класс _Calculator_ калькулятора, модуль _calculator_](#calc)
    - [Внешние подключаемые модули](#import_calc)
    - [Инициализация и атрибуты экземпляра калькулятора](#init_calc)
    - [Чтение клавиатуры, метод _processKeys( )_](#read_keys)
    - [Вывод на экран процесса расчетов калькулятора, метод _displayRegisters( )_](#display)
    - [Ввод чисел в калькулятор, метод _pressedDigitalKey( )_](#input_keys)
    - [Обработка операции сложения, вычитания и т.п., метод _pressedOpcode( )_](#op_keys)
    - [Обработка нажатия клавиши "равно", метод _pressedEqual( )_](#eq_key)
    - [Общий сброс калькулятора, метод _clear( )_](#reset)
3. [Класс _Flags_ флагов калькулятора, модуль _flags_](#flags):
    - [Инициализация и атрибуты экземпляра](#init_flags)
    - [Флаг _CD_](#cd_flag)
    - [Флаг _CONST_](#const_flag)
    - [Флаг _EQ_](#eq_flag)
    - [Открытые свойства класса](#props_flags)
    - [Рабочие комбинации флагов](#combo_flags)
    - [Очистка флагов калькулятора, метод _clear( )_](#reset_flags)
    - [Вспомогательные методы](#support_methods)
4. [Классы _Registry_ регистров калькулятора, модуль _registers_](#registry):
    - [Внешние подключаемые модули](#import_reg)
    - [Инициализация и атрибуты экземпляра](#init_reg)
    - [Cвойства экземпляров класса](#props_reg)
    - [Методы _clear( )_, _BS( )_, _truncate( )_, специальный метод _\_\_str\_\_( )_](#methods_reg)
    - [Ввод значения числа, метод _input( )_](#input_reg)
    - [Копирование содержимого регистра, метод _copyFrom( )_](#copy_reg)
    - [Специальный регистр Z, класс _RegistryZ( )_](#z_reg)
    - [Инициализация и атрибуты экземпляра регистра Z](#init_z)
    - [Свойство _value_](#value_regz)
5. [Класс _ALU_ арифметико-логического устройства, модуль _ALU_](#alu):
    - [Внешние подключаемые модули](#import_alu)
    - [Инициализация и атрибуты экземпляра](#init_alu)
    - [Cвойства экземпляров класса](#props_alu)
    - [Методы _clear( )_, _BS( )_, _truncate( )_, _input( )_](#methods_alu)
    - [Алгоритм работы АЛУ, метод _process( )_](#process_alu)
    - [Распределение обработки операции, метод _\_\_operate( )_](#operate_alu)
6. [Класс _BigFloat_ большого числа, модуль _bigfloat_](#bigfloat):
    - [Константы класса](#const_bf)
    - [Инициализация и атрибуты экземпляра](#init_bf)
    - [Cвойства экземпляров класса](#props_bf)
    - [Методы _BS( )_, _truncate( )_, _copy( )_](#methods_bf)
    - [Генератор обхода числа по цифрам, метод _extract( )_](#extract_bf)
    - [Вычисление максимальных длин целой и дробной частей, метод _\_\_max_len( )_](#maxlen_bf)
    - [Конвертирование типов чисел _int_ и _float_ в экземпляр _BigFloat_, метод _\_\_convert_type( )_](#convert_bf)
    - [Генератор операции сложения, метод _\_\_operation( )_](#operation_bf)
    - [Специальные методы сравнения _\_\_eq\_\_( )_, _\_\_lt\_\_( )_, _\_\_le\_\_( )_, _\_\_gt\_\_( )_, _\_\_ge\_\_( )_](#cmp_bf)
    - [Специальные методы вывода _\_\_str\_\_( )_, _\_\_format\_\_( )_](#output_bf)
    - [Специальные математические методы _\_\_add\_\_( )_, _\_\_sub\_\_( )_, _\_\_abs\_\_( )_](#math_bf)
7. [Класс _Sign_ знака большого числа, модуль _bigfloat_](#sign):
    - [Инициализация и атрибуты экземпляра](#init_sign)
    - [Cвойство _\_sign_](#value_sign)
    - [Специальные методы _\_\_add\_\_( )_, _\_\_eq\_\_( )_, _\_\_invert\_\_( )_, _\_\_str\_\_( )_](#spec_sign)

___
## <a id="launch"></a> Запуск калькулятора, модуль `testing`
Данный модуль используется для запуска калькулятора и может задавать режимы вывода информации о действиях калькулятора.
#### Тестовый режим 0
Тестовый режим работы, отображение регистров и флагов. Результат каждой операции выводиться в отдельной строке.
#### Тестовый режим 1
Тестовый режим работы, отображение регистров и флагов. Результат каждой операции выводиться в той же самой строке.
Старый результат удаляется. Показывает только последнюю выполненную операцию.
#### Тестовый режим 2
Рабочий режим калькулятора, выводит на экран только его дисплей.
#### Тестовый режим 3
Специальный тестовый режим работы, отображение регистров и флагов.
Результат каждой операции возвращается как строка значений для использования в утверждениях _assert_ тестов калькулятора в _pytest_.

[<img src="https://img.icons8.com/officel/30/000000/double-up.png"/> &nbsp; <big>Оглавление</big>](#contents)
___
## <a id="calc"></a> Класс ***Calculator*** калькулятора, модуль `calculator`
Описывается базовый класс калькулятора, его методы и атрибуты.
Класс используется для объединения в себе аналога клавиатуры, дисплея, арифметико-логического устройства АЛУ и флагов.
___
#### <a id="import_calc"></a> Внешние подключаемые модули
- модуль [**msvcrt**](https://docs.python.org/3/library/msvcrt.html "Документация к модулю msvcrt"). Обработка нажатия клавиш клавиатуры.
- модуль **flags**. Флаги калькулятора.
- модуль **ALU**. Арифметико-логическое устройство калькулятора (АЛУ).
#### <a id="init_calc"></a> ***init*** Инициализация и атрибуты экземпляра калькулятора, конструктор
**IN** Входные параметры конструктора:
- **mode** - режим работы калькулятора. Значение по умолчанию - 0.

Атрибуты **self** экземпляра:
- <a id="self_op"></a> **self.OP** - текущее арифметическое действие. В данной версии калькулятора используются только '+', '-', '*' и '/'.
- **self.flags** - флаги калькулятора.
- **self.mode** - режим работы калькулятора (отладочный или рабочий).
- **self.__ALU** - инициализация АЛУ (также передается ссылка на флаги).

Калькулятор инициализируется базовыми значениями, выводит краткую инструкцию по использованию калькулятора и отображает на экране состояние калькулятора.
#### <a id="read_keys"></a> ***processKeys( )*** Чтение клавиатуры, метод
Действия метода:
- Цикл обработки нажатия клавиш с клавиатуры с помощью модуля [**msvcrt**](https://docs.python.org/3/library/msvcrt.html "Документация к модулю msvcrt").
Первичное распределение по методам обработки в зависимости от нажатой клавиши.
#### <a id="display"></a> ***displayRegisters( )*** Вывод на экран процесса расчетов калькулятора, метод
Действия метода:
- Отображает содержимое регистров и/или флагов в соответствии с выбранным режимом работы **mode**.
Тестовые режимы **0** и **1** выводят отладочную информацию на экран,
а режим **3** возвращает ее для отображения в файлах _pytest_ тестов.
Режим **2** просто выводит последнее вычисленное значение калькулятора.

#### <a id="input_keys"></a> ***pressedDigitalKey( )*** Ввод чисел в калькулятор, метод
**IN** Входные параметры метода:
- **c** - введенный цифровой или разделительный символ или _Backspace_. Значение по умолчанию - нет.

Действия метода:
- управляет флагами **EQ** и **CD**.
Передает управление методам АЛУ _BS( )_ или _input( )_ в зависимости от введенного символа.

#### <a id="op_keys"></a> ***pressedOpcode( )*** Обработка операции сложения, вычитания и т.п., метод
**IN** Входные параметры метода:
- **c** - введенный символ операции (в данной версии только '+', '-', '*' и '/'). Значение по умолчанию - нет.

Действия метода:
- управляет флагами **EQ**, **CONST** и **CD**, атрибутом [**self.OP**](#self_op).
Передает управление методам АЛУ _truncate( )_ или _process( )_.

#### <a id="eq_key"></a> ***pressedEqual( )*** Обработка нажатия клавиши "равно", метод
Действия метода:
- управляет флагами **EQ**, **CONST** и **CD**.
Передает управление методам АЛУ _truncate( )_ или _process( )_.

#### <a id="reset"></a> ***clear( )*** Общий сброс калькулятора, метод
Действия метода:
- управляет флагами **EQ**, **CONST** и **CD**.
Передает управление методам _clear( )_ АЛУ и класса флагов. Очищает атрибут [**self.OP**](#self_op).

[<img src="https://img.icons8.com/officel/30/000000/double-up.png"/> &nbsp; <big>Оглавление</big>](#contents)
___
## <a id="flags"></a> Класс ***Flags*** флагов калькулятора, модуль `flags`
Описывается класс флагов калькулятора, его методы и атрибуты.
Класс используется для организации работы флагов калькулятора, которые управляют заполнением дисплея,
вводом управляющих символов операций.  
**Included IN** Входит в состав следующих классов:
- [**Calculator**](#calc "Описание класса Calculator") - базовый класс калькулятора.
- [**ALU**](#alu "Описание класса ALU") - класс АЛУ калькулятора.
___
#### <a id="init_flags"></a> ***init*** Инициализация и атрибуты экземпляра
Атрибуты **self** экземпляра:
- [**self.__CD**](#cd_flag "Описание флага CD") - clear display, флаг управления вводом значения в дисплей калькулятора. Значение по умолчанию - 1 (True).
- [**self.__CONST**](#const_flag "Описание флага CONST") - constant, флаг управления операциями калькулятора. Значение по умолчанию - 0 (False).
- [**self.__EQ**](#eq_flag "Описание флага EQ") - equal, флаг нажатия клавиши "равно". Значение по умолчанию - 0 (False).

#### <a id="cd_flag"></a> ***CD*** Флаг управления вводом значения
Флаг CD (clear display) управляет вводом значения в дисплей калькулятора (регистр А).  
Значение 1 (True) означает, что новый ввод в регистр A затрет старые результаты, а так же в комбинации с CONST=1, что в А есть число.  
Значение 0 (False) означает, что ввод в регистр А разрешен.
#### <a id="const_flag"></a> ***CONST*** Флаг управления операциями калькулятора
Флаг CONST (constant) управляет операциями калькулятора.  
Значение 1 (True) означает незавершенную операцию.
Незавершенная операция - это последовательный ввод арифметических действий, пока не будет нажата клавиша "равно".
В случае незавершенной операции вычисления ведуться как B op A.  
Значение 0 (False) означает, что операция завершена.
Если операция завершена, то предполагается что второго операнда нет и он берется из регистра В и, соответственно,
рассчитывается в обратном порядке, как A op B.  
Используется для выбора алгоритма работы АЛУ.
#### <a id="eq_flag"></a> ***EQ*** Флаг нажатия клавиши "равно"
Флаг EQ (equal) сообщает о нажатии клавиши "равно".  
Используется для выбора алгоритма работы АЛУ.
#### <a id="props_flags"></a> ***properties*** Открытые свойства класса
Поскольку сами атрибуты флагов теперь закрыты, для их чтения используются стандартные геттеры свойств.
Это необходимо для отображения значений флагов в [отладочных режимах](#launch) работы калькулятора.
- [**CD**](#cd_flag "Описание флага CD") - clear display, свойство флага управления вводом значения в дисплей калькулятора.
- [**CONST**](#const_flag "Описание флага CONST") - constant, свойство флага управления операциями калькулятора.
- [**EQ**](#eq_flag "Описание флага EQ") - equal, свойство флага нажатия клавиши "равно".
#### <a id="combo_flags"></a> Рабочие комбинации флагов
Рабочие комбинации флагов необходимы для удобного описания их оказываемого действия на системы в целом.
Это может просто вывод значений флага или их комбинации для выбора алгоритма работы АЛУ.  
Некоторые комбинации флагов могут не использоваться в текущей версии калькулятора, но применялись в прошлом или будут использоваться в будущем.
- **IS_REG_FILLING** - заполняется ли текущий регистр (дисплей) калькулятора?
- **IS_NEW_INPUT** - будет осуществлен ввод нового числа (старое значение затрется)?
- **IS_OPS_CONTINUES** - продолжается текущий цикл ввода операций?
- **IS_OPS_STOPPED** - цикл ввода операций прерван?
- **IS_EQUAL_PRESSED** - была ли нажата клавиша "равно"?
- **IS_OPERATON_POSSIBLE** - возможно ли провести операцию (все ли условия выполнены)?
- **IS_B_op_A** - необходима операция вида B op A (выбор алгоритма работы АЛУ)?
- **IS_A_op_B** - необходима операция вида A op B (выбор алгоритма работы АЛУ)?
- **IS_UNKNOWN_OPERATION** - неизвестная операция?
#### <a id="reset_flags"></a> ***clear( )*** Очистка флагов калькулятора, метод
Очищает флаги калькулятора. Приводит их в состояние начальной [инициализации](#init_flags "Инициализация флагов калькулятора") класса.
#### <a id="support_methods"></a> Вспомогательные методы
Методы используются (или использовались в прошлом) для отладки калькулятора. Можно удалить или преобразовать.
- **check( )** - выводит информацию о флагах в булевом виде.
- **control( )** - выводит информацию о флагах в цифровом виде (True = 1, False = 0).  

[<img src="https://img.icons8.com/officel/30/000000/double-up.png"/> &nbsp; <big>Оглавление</big>](#contents)
___
## <a id="registry"></a> Класс ***Registry*** и ***RegistryZ*** регистров калькулятора, модуль `registers`
Описывается классы регистров калькулятора, его методы и атрибуты.
Класс используется для организации работы регистров калькулятора, которые хранят значение чисел.  
**Регистры**, используемые в данной версии:
- **A** - регистр А калькулятора, представляющий собой виртуальный дисплей, куда вводятся данные и выводится результат вычисления.
- **B** - регистр В калькулятора. Хранит предыдущее введенное значение.
- **Z** - регистр Z калькулятора. Принимает и хранит результат вычисления операции.  

**Included IN** Включен в состав следующих классов:
- [**ALU**](#alu "Описание класса ALU") - класс АЛУ калькулятора.
___
#### <a id="import_reg"></a> ***import*** Внешние подключаемые модули
- модуль **bigfloat**. Класс [BigFloat](#bigfloat "Описание класса BigFloat") содержит представление большого числа теоретически неограниченной точности.
#### <a id="init_reg"></a> ***init*** Инициализация и атрибуты экземпляра
**IN** Входные параметры конструктора:
- **name** - название регистра калькулятора. Значение по умолчанию - нет.

Атрибуты **self** экземпляра:
- **self.__name** - наименование регистра калькулятора. Значение по умолчанию - нет.
- **self._value** - значение регистра калькулятора, экземпляр класса [BigFloat](#bigfloat "Описание класса BigFloat"). Значение по умолчанию - стандартное значение конструктора числа BigFloat.
#### <a id="props_reg"></a> ***properties*** Cвойства экземпляров класса
- **name** - возвращает название текущего регистра.
- **value** - getter свойства возвращает экземпляр числа _BigFloat_, содержащийся в текущем регистре.
Setter запрещает присваивать извне значения базовым регистрам калькулятора.
- **comma** - возвращает значение свойства _comma_ (запятая) экземпляра числа _BigFloat_.
- **sign** - возвращает значение свойства _sign_ (знак числа) экземпляра числа _BigFloat_.
- **len_int** - возвращает длину целой части числа текущего регистра.
- **len_frac** - возвращает длину дробной части числа текущего регистра.
#### <a id="methods_reg"></a> ***methods*** Методы _clear( )_, _BS( )_, _truncate( )_, специальный метод _\_\_str\_\_( )_
- **clear( )** - сброс содержимого текущего регистра, просто создает новый экземпляр числа _BigFloat_.
- **BS( )** - затирает последний символ регистра, делегирует вызов экземпляру числа _BigFloat_.
- **truncate( )** - удаляет незначащие нули целой и дробной частей текущего регистра, делегирует вызов экземпляру числа _BigFloat_.
- **\_\_str\_\_( )** - возвращает строкое представление экземпляра числа _BigFloat_ текущего регистра.
#### <a id="input_reg"></a> ***input( )*** Ввод значения числа, метод
Основной метод, обслуживающий ввод цифр числа и запятой в регистр **А**.
**IN** Входные параметры метода:
- **c** - цифровой символ или символ запятой (точка в данной интерпретации). Значение по умолчанию - нет.
- **flags** - экземпляр класса флагов с их текущим состоянием. Значение по умолчанию - нет.
#### <a id="copy_reg"></a> ***copyFrom( )*** Копирование содержимого регистра, метод
Копирует содержимое (экземпляр числа _BigFloat_) из заданного регистра в текущий. Использует метод _copy( )_ класса _BigFloat_.
**IN** Входные параметры метода:
- **R** - заданный регистр (экземпляр числа _BigFloat_). Значение по умолчанию - нет.
#### <a id="z_reg"></a> ***RegistryZ*** Специальный регистр **Z**, класс
Специальный регистр АЛУ, в котором хранится значение результата операции калькулятора.
Наследует свойства и методы суперкласса [_Registry_](#registry).
#### <a id="init_z"></a> ***init*** Инициализация и атрибуты экземпляра
Делегирует инициализацию суперклассу [_Registry_](#registry). Передает ему зарезервированное имя регистра **Z**.
#### <a id="value_regz"></a> ***value*** Ввод и вывод значения числа, свойство
- **value.getter** - возвращает экземпляр числа _BigFloat_, содержащийся в текущем регистре **Z**.
- **value.setter** - основной метод, обслуживающий ввод цифр числа и запятой в регистр **Z**.

**IN** Входные параметры метода:
- **merger** - генератор результата вычисления АЛУ. Значение по умолчанию - нет.

[<img src="https://img.icons8.com/officel/30/000000/double-up.png"/> &nbsp; <big>Оглавление</big>](#contents)
___
